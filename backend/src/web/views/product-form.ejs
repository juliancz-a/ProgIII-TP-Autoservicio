<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/user.png" type="image/x-icon">
        <link rel="stylesheet" href="/style.css">
        <link rel="stylesheet" href="/product-form.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <title>Formulario</title>
    </head>
    <body>
        <aside class="sidebar">
            <h2>Admin</h2>
            <div class="hamburger-menu" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
            <nav>
                <ul id="nav-buttons" class="nav-buttons">
                    <li><a href="/dashboard?username=<%= username %>">Dashboard</a></li>
                    <li><a href="">Orders</a></li>
                    <li><a href="">Products</a></li>
                    <li><a href="/login"><p>Logout</p><span class="material-symbols-outlined">logout</span></a></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <div class="form-container">
                <% if (product) { %>
                    <form action="/dashboard/edit/<%= product.id %>?username=<%= encodeURIComponent(username) %>" method="POST" class="product-form">
                        <section>
                            <div class="product-inputs">
                                <div class="form-group">
                                    <label class="input-label" for="title">Title</label>
                                    <input 
                                        type="text" 
                                        id="title" 
                                        name="title" 
                                        value="<%= product.title %>" 
                                        placeholder="Name of the product" 
                                        autocomplete="off" />
                                </div>

                                <div class="form-group">
                                    <label class="input-label" for="description">Description</label>
                                    <input 
                                        type="text" 
                                        id="description"
                                        name="description"
                                        value="<%= product.description %>" 
                                        placeholder="Description of the product"
                                        autocomplete="off" />
                                </div>

                                <div class="form-group">
                                    <label class="input-label" for="category">Category</label>
                                    <select name="category" id="category">
                                        <option value="" disabled <%= !product ? 'selected' : '' %> hidden>Seleccionar categoría</option>
                                        <option value="accessory" <%= product.category === 'accessory' ? 'selected' : '' %>>Accessory</option>
                                        <option value="component" <%= product.category === 'component' ? 'selected' : '' %>>Component</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="input-label" for="price">Price</label>
                                    <input 
                                        type="number" 
                                        id="price"
                                        name="price"
                                        value="<%= product.price %>" 
                                        placeholder="Price of the product"
                                        autocomplete="off"
                                        min="0"
                                        step="0.01" />
                                </div>

                                <div class="form-group">
                                    <label class="input-label" for="image">Image</label>
                                    <textarea 
                                        type="text" 
                                        id="img"
                                        name="img"
                                        placeholder="URL for the image of the product"
                                        autocomplete="off"
                                        rows="4"><%= product.img %></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="input-label" for="status">Status</label>
                                    <div class="status-toggle">
                                        <label class="status-radio">
                                            <input type="radio" name="enabled" value="true" <%= product.enabled ? 'checked' : '' %>>
                                            <span>Activo</span>
                                        </label>
                                        <label class="status-radio">
                                            <input type="radio" name="enabled" value="false" <%= !product.enabled ? 'checked' : '' %>>
                                            <span>Inactivo</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="product-preview">
                                <img src="<%= product.img %>" alt="<%= product.title %>" />
                                <p><%= product.title %></p>
                                <p><%= product.description %></p>
                                <p><%= product.category.charAt(0).toUpperCase() + product.category.slice(1) %></p>
                                <h5 class="price">$<%= product.price.toFixed(2) %></h5>
                                <p class="status <%= product.enabled ? 'status-active' : 'status-inactive' %>">
                                    <%= product.enabled ? 'Activo' : 'Inactivo' %>
                                </p>
                            </div>
                        </section>

                        <button id="save" type="submit" class="btn btn-primary">Guardar cambios</button>
                    </form>
                <% } else { %>
                    <h1>No se encontró el producto</h1>
                <% } %>
            </div>
        </main>
    </body>
    <script>
        const priceInput = document.getElementById('price');

        priceInput.addEventListener('keypress', (e) => {
            const char = e.key;
            const currentValue = priceInput.value;

            // Permitir dígitos
            if (/\d/.test(char)) return;

            // Permitir un solo punto decimal
            if (char === '.' && !currentValue.includes('.')) return;

            // Bloquear todo lo demás
            e.preventDefault();
        });

        const saveBtn = document.getElementById('save');

        saveBtn.addEventListener('click', () => {
            alert(`NO TE VAYAS CHAVO, ${window}`);
        })
    </script>
</html>